<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<title>exercise01</title>
	<link rel="stylesheet" href="css/exercise.css">
</head>

<body>
    <div class="mobile__mask"><div>本練習只提供手機模式測驗</div></div>
	<div class="demo">
        <div class="star" >
            <canvas id="canvas"></canvas>
            <div class="arrow"><img src="images/arrow.svg" alt=""></div>
            <div class="star__item">
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
            </div>
            <div class="star__bg">
                <div class="item"><img src="images/img-star.jpg" alt=""></div>
                <div class="item" style="display: none;"><img src="images/img-star-p.jpg" alt=""></div>
            </div>
        </div>
        <div class="tips">請跟著指示畫出五芒星解鎖</div>
	</div>
	<div class="endCut" style="display: none;">
        <div>
            <span>覆蓋這張卡片，結束這回合!!</span>
            <button type="button" class="endCut__button" onclick="replay()">再玩一次</button>
        </div>
    </div>
	<script src="js/min/jquery-1.11.2.min.js"></script>
    <script>
        // define global variable
        let obj,value;
        let canvas = document.getElementById("canvas"),
            spirit, startX, startY;
        let demo = document.querySelector(".demo"),
            endcut = document.querySelector(".endCut"),
            arrow = document.querySelector(".arrow"),
            bg = document.querySelectorAll(".star__bg .item");
        let point = document.querySelectorAll(".star__item .item");
        // let a,b,c,d,e,f;
        let magicarr = [];

        // touch start listener
        function objStyle(obj,value){ obj.style.display = value;};
        function touchmove(event) {
            event.preventDefault();
                if (spirit || !event.touches.length) return;
                let touch = event.touches[0];
                startX = touch.pageX;
                startY = touch.pageY;
                // console.log(startX,startY);
                if (startX > 60 && startX < 100 && startY < 340 && startY > 315) {
                    // console.log("這個是下面右邊的那個點點~");                 
                    point[4].classList.add("touch");
                    magicarr.push("2");  
                }
                if (startX > 325 && startX < 350 && startY < 172 && startY > 150){
                    // console.log("這個是下面左邊的那個點點~");             
                    point[1].classList.add("touch");
                    magicarr.push("3");  
                }
                if (startX > 20 && startX < 50 && startY < 170 && startY > 130) {
                    // console.log("這個是左邊的那個點點~");               
                    point[3].classList.add("touch");
                    magicarr.push("4"); 
                }
                if (startX > 260 && startX < 290 && startY < 340 && startY > 300) {
                    // console.log("這個是右邊的那個點點~");                 
                    point[2].classList.add("touch");
                    magicarr.push("5");  
                }
                if (startX > 190 && startX < 210 && startY < 80 && startY > 50) {
                    // console.log("最後的點點");                 
                    magicarr.push("0"); 
                }
            }
            
            function touchstart(event) {
                event.preventDefault();
                if (spirit || !event.touches.length) return;
                let touch = event.touches[0];
                startX = touch.pageX;
                startY = touch.pageY;
                objStyle(arrow,"none");
                
               
                if (startX > 160 && startX < 240 && startY < 40 && startY > 0) { 
                    // console.log("這個是上面的那個點點~");                  
                    point[0].classList.add("touch");
                    magicarr.push("1");       
                }
                canvas.addEventListener("touchmove", touchmove, false);
                
            };
            function touchend(event) {
                let checkarr = [1,2,3,4,5,0];
                let finalarr = magicarr.filter(function(element, index, arr){
                    return arr.indexOf(element) === index;
                });
                console.log(finalarr);
                if ( finalarr.toString() === checkarr.toString() ) {
                    console.log("畫完魔法陣囉...我要接著跳轉囉！！")
                    setTimeout(function(){
                        objStyle(bg[0],"none");
                        objStyle(bg[1],"block");
                    },1000);
                    setTimeout(function(){
                        objStyle(demo,"none");
                        objStyle(endcut,"block");
                    },3000)
                } else {
                    replay();
                    console.log("你順序不對啦")
                }
            }
        // add touch start listener
        
        canvas.addEventListener("touchstart", touchstart, false);
        canvas.addEventListener("touchend", touchend, false);
        
        function replay(){
            objStyle(bg[1],"none");
            objStyle(bg[0],"block");
            objStyle(demo,"block");
            objStyle(endcut,"none");
            objStyle(arrow,"block");
            magicarr = [];
            var i;
            for (i = 0; i < point.length; i++) {
                point[i].classList.remove("touch");
            }
        };

    </script>
</body>

</html>